<html>
 <head>
	<script type="text/javascript">
		var PlayerState = {"paused" : 0, "playing" : 1};

		function getProstoPleerUrl() {
			return 'http://music.yandex.ru/';
		};

		function isProstopleerUrl(url) {
			var result = false;
			var prostopleer = getProstoPleerUrl();
			if (url.indexOf(prostopleer) != 0)
				result = false;
			else {
				result = true;
			}
			return result;
		};

		function openProstoPleerInNewTab() {
			chrome.tabs.create({"url" : getProstoPleerUrl() });
		}
	
	        function pressPlayButton() {
			chrome.tabs.getAllInWindow(undefined, function(tabs) {
			var prostoPleerFound = false;
			for (var i = 0, tab; tab = tabs[i]; i++) {
			  if (tab.url && isProstopleerUrl(tab.url)) {
				chrome.tabs.executeScript(tab.id, {"file": "scripts/pressPlayButton.js"});
					prostoPleerFound = true;
					break;
				  }
				}
				if (!prostoPleerFound) {
					openProstoPleerInNewTab();
				}
			});
        	};

		function updateMainButtonState(playerState) {
			if (playerState == PlayerState.paused) {
        			chrome.browserAction.setIcon({path: "images/icon-pause.png"});
			} else {
				chrome.browserAction.setIcon({path: "images/icon-play.png"});
			}
		};

		chrome.browserAction.onClicked.addListener(function(tab) {
			pressPlayButton();
		});

        	chrome.extension.onRequest.addListener(function(request, sender, sendResponse) {
			if (request == "playing") {
				updateMainButtonState(PlayerState.playing);
			}
			else {
				updateMainButtonState(PlayerState.paused);
			}
        	});
	</script>
 </head>
 <body>
 </body>
</html>
